<?xml version='1.0'?>
<sdf version='1.11'>
  <model name='robot-model'>

    <link name='robot-base'>
      <pose>0 0 0 0 0 0</pose>
      <visual name='robot-base-v'>
        <!-- mesh -->
        <geometry>
          <mesh>
            <uri>file://robot_base.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
        <material>
          <diffuse>1 0 0 1</diffuse>
          <ambient>1 0 0 1</ambient>
          <!-- specular -->
        </material>
      </visual>
      <collision name='robot-base-c'>
        <geometry>
          <mesh>
            <uri>file://robot_base.stl</uri>
            <scale>0.001 0.001 0.001</scale>
          </mesh>
        </geometry>
      </collision>
      <inertial auto='true'>
        <mass>1000</mass>
      </inertial>
    </link>

	<link name='wheel-frontleft'>
      <pose degrees='true'>0.1 0.075 0 90 0 0</pose>
      <visual name='robot-frontleft-v'>
        <!-- mesh -->
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
        <material>
          <diffuse>1 0 0 1</diffuse>
          <ambient>1 0 0 1</ambient>
          <!-- specular -->
        </material>
      </visual>
      <collision name='robot-frontleft-c'>
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
      </collision>
      <inertial auto='true'>
        <mass>1</mass>
      </inertial>
	</link>
	
	<link name='wheel-backleft'>
      <pose degrees='true'>-0.1 0.075 0 90 0 0</pose>
      <visual name='robot-backleft-v'>
        <!-- mesh -->
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
        <material>
          <diffuse>1 0 0 1</diffuse>
          <ambient>1 0 0 1</ambient>
          <!-- specular -->
        </material>
      </visual>
      <collision name='robot-backleft-c'>
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
      </collision>
      <inertial auto='true'>
        <mass>1</mass>
      </inertial>
	</link>

	<link name='wheel-frontright'>
      <pose degrees='true'>0.1 -0.075 0 90 0 0</pose>
      <visual name='robot-frontright-v'>
        <!-- mesh -->
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
        <material>
          <diffuse>1 0 0 1</diffuse>
          <ambient>1 0 0 1</ambient>
          <!-- specular -->
        </material>
      </visual>
      <collision name='robot-frontright-c'>
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
      </collision>
      <inertial auto='true'>
        <mass>1</mass>
      </inertial>
	</link>

	<link name='wheel-backright'>
      <pose degrees='true'>-0.1 -0.075 0 90 0 0</pose>
      <visual name='robot-backright-v'>
        <!-- mesh -->
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
        <material>
          <diffuse>1 0 0 1</diffuse>
          <ambient>1 0 0 1</ambient>
          <!-- specular -->
        </material>
      </visual>
      <collision name='robot-backright-c'>
        <geometry>
			<cylinder>
				<radius>0.02</radius>
				<length>0.02</length>
			</cylinder>
        </geometry>
      </collision>
      <inertial auto='true'>
        <mass>1</mass>
      </inertial>
	</link>

    <joint name='frontleft' type='revolute'>
      <pose>0 0 0 0 0 0</pose>
      <parent>robot-base</parent>
      <child>wheel-frontleft</child>
      <axis>
        <xyz>0 0 1</xyz>
      </axis>
    </joint>

    <joint name='frontright' type='revolute'>
      <pose>0 0 0 0 0 0</pose>
      <parent>robot-base</parent>
      <child>wheel-frontright</child>
      <axis>
        <xyz>0 0 1</xyz>
      </axis>
    </joint>

    <joint name='backleft' type='revolute'>
      <pose>0 0 0 0 0 0</pose>
      <parent>robot-base</parent>
      <child>wheel-backleft</child>
      <axis>
        <xyz>0 0 1</xyz>
      </axis>
    </joint>

    <joint name='backright' type='revolute'>
      <pose>0 0 0 0 0 0</pose>
      <parent>robot-base</parent>
      <child>wheel-backright</child>
      <axis>
        <xyz>0 0 1</xyz>
      </axis>
    </joint>

    <!-- plugin filename='StocktakeRobot'></plugin -->
	
	<!-- add diff drive plugin here -->
	
	<link name='robot-lidar'>
		<pose>0 0 0.05 0 0 0</pose>
      <visual name='robot-lidar-v'>
        <!-- mesh -->
        <geometry>
			<cylinder>
				<radius>0.05 </radius>
				<length>0.02 </length>
			</cylinder>
        </geometry>
        <material>
          <diffuse>1 0 0 1</diffuse>
          <ambient>1 0 0 1</ambient>
          <!-- specular -->
        </material>
      </visual>
      <collision name='robot-base-c'>
        <geometry>
			<cylinder>
				<radius>0.05 </radius>
				<length>0.02 </length>
			</cylinder>
        </geometry>
      </collision>

		<sensor name='robot-lidar' type='gpu_lidar'>
			<topic>lidar</topic>
			<update_rate>10</update_rate>
			<always_on>1</always_on>
			<visualize>true</visualize>
			<ray>
				<scan>
					<horizontal>
						<samples>640</samples>
						<resolution>1</resolution>
						<min_angle>-1.396263</min_angle>
						<max_angle>1.396263</max_angle>
					</horizontal>
					<vertical>
						<samples>640</samples>
						<resolution>1</resolution>
						<min_angle>-1.396263</min_angle>
						<max_angle>1.396263</max_angle>
					</vertical>
				</scan>
				<range>
					<min>0.08</min>
					<max>10.0</max>
					<resolution>0.01</resolution>
				</range>
			</ray>
		</sensor>
	</link>

    <joint name='lidarjoint' type='fixed'>
      <pose>0 0 0 0 0 0</pose>
      <parent>robot-base</parent>
      <child>robot-lidar</child>
      <axis>
        <xyz>1 0 0</xyz>
      </axis>
    </joint>

    <plugin
        filename="gz-sim-diff-drive-system"
        name="gz::sim::systems::DiffDrive">
        <left_joint>frontleft</left_joint>
        <right_joint>frontright</right_joint>
        <wheel_separation>1.5</wheel_separation>
        <wheel_radius>0.02</wheel_radius>
        <odom_publish_frequency>1</odom_publish_frequency>
        <max_linear_acceleration>1</max_linear_acceleration>
        <min_linear_acceleration>-1</min_linear_acceleration>
        <max_angular_acceleration>2</max_angular_acceleration>
        <min_angular_acceleration>-2</min_angular_acceleration>
        <max_linear_velocity>0.5</max_linear_velocity>
        <min_linear_velocity>-0.5</min_linear_velocity>
        <max_angular_velocity>1</max_angular_velocity>
        <min_angular_velocity>-1</min_angular_velocity>
      </plugin>

	<link name="imu">
		<pose>0 0 0.1 0 0 0 </pose>
		<visual name="imu-v">
			<geometry>
				<box><size>0.02 0.02 0.02</size></box>
			</geometry>
		</visual>
		<collision name="imu-c">
			<geometry>
				<box><size>0.02 0.02 0.02</size></box>
			</geometry>
		</collision>
	</link>
	
    <joint name='imujoint' type='fixed'>
      <pose>0 0 0 0 0 0</pose>
      <parent>robot-base</parent>
      <child>imu</child>
      <axis>
        <xyz>1 0 0</xyz>
      </axis>
    </joint>

  </model>
</sdf>
